<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Weather Dashboard</title>

<style>
body {
  font-family: Arial;<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒ¦ Ù„ÙˆØ­Ø© Ø§Ù„Ø·Ù‚Ø³ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%);
            color: #e2e8f0;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1300px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
        }
        
        h1 {
            font-size: 2.8rem;
            background: linear-gradient(to right, #38bdf8, #818cf8);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 20px;
            background: rgba(30, 41, 59, 0.7);
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 30px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }
        
        .select-wrapper, .date-wrapper {
            position: relative;
            flex: 1;
            min-width: 200px;
        }
        
        select, input, button {
            padding: 14px 18px;
            border-radius: 12px;
            border: none;
            font-size: 16px;
            width: 100%;
            transition: all 0.3s ease;
        }
        
        select {
            background: #1e293b;
            color: white;
            border: 1px solid #475569;
            cursor: pointer;
            appearance: none;
            padding-right: 45px;
        }
        
        input {
            background: #1e293b;
            color: white;
            border: 1px solid #475569;
        }
        
        button {
            background: linear-gradient(135deg, #3b82f6, #6366f1);
            color: white;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            min-width: 180px;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 14px rgba(59, 130, 246, 0.4);
        }
        
        #backBtn {
            background: linear-gradient(135deg, #64748b, #475569);
        }
        
        #backBtn:hover {
            box-shadow: 0 7px 14px rgba(100, 116, 139, 0.4);
        }
        
        .select-wrapper i, .date-wrapper i {
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            color: #94a3b8;
            pointer-events: none;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .weather-card {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .weather-card:hover {
            transform: translateY(-5px);
            border-color: rgba(59, 130, 246, 0.3);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #334155;
        }
        
        .card-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #38bdf8;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-time {
            font-size: 0.9rem;
            color: #94a3b8;
        }
        
        .weather-data {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        
        .data-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 12px;
        }
        
        .data-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
        }
        
        .data-content h3 {
            font-size: 0.9rem;
            color: #94a3b8;
            margin-bottom: 5px;
        }
        
        .data-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #f8fafc;
        }
        
        .data-unit {
            font-size: 1rem;
            color: #94a3b8;
            margin-right: 3px;
        }
        
        /* Ø§Ù„Ø¨ÙˆØµÙ„Ø© */
        .compass-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 15px;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 12px;
            grid-column: span 2;
        }
        
        .compass-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: #38bdf8;
        }
        
        .compass {
            position: relative;
            width: 180px;
            height: 180px;
            margin: 0 auto;
        }
        
        .compass-circle {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(
                from 0deg,
                #ef4444 0deg, #f97316 45deg, #eab308 90deg, 
                #22c55e 135deg, #0ea5e9 180deg, #3b82f6 225deg, 
                #8b5cf6 270deg, #ec4899 315deg, #ef4444 360deg
            );
            position: relative;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
        }
        
        .compass-directions {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
        }
        
        .direction {
            position: absolute;
            font-weight: bold;
            color: white;
            text-shadow: 0 0 3px rgba(0, 0, 0, 0.8);
        }
        
        .n { top: 5%; left: 50%; transform: translateX(-50%); }
        .e { top: 50%; right: 5%; transform: translateY(-50%); }
        .s { bottom: 5%; left: 50%; transform: translateX(-50%); }
        .w { top: 50%; left: 5%; transform: translateY(-50%); }
        
        .compass-needle {
            position: absolute;
            top: 50%;
            left: 50%;
            transform-origin: center bottom;
            transition: transform 0.5s ease;
            z-index: 10;
        }
        
        .needle {
            width: 4px;
            height: 80px;
            background: #f8fafc;
            border-radius: 2px;
            position: relative;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }
        
        .needle::after {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-top: 15px solid #ef4444;
        }
        
        .compass-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            background: #1e293b;
            border-radius: 50%;
            z-index: 11;
            border: 3px solid #f8fafc;
        }
        
        .wind-direction {
            margin-top: 15px;
            font-size: 1.2rem;
            color: #38bdf8;
            font-weight: 600;
        }
        
        /* Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø±Ø´ÙŠÙ */
        .archive-container {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        
        .archive-title {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: #38bdf8;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        th {
            background: rgba(59, 130, 246, 0.2);
            color: #38bdf8;
            padding: 16px 12px;
            text-align: center;
            font-weight: 600;
            border-bottom: 2px solid #334155;
        }
        
        td {
            padding: 14px 12px;
            text-align: center;
            border-bottom: 1px solid #334155;
        }
        
        tr:hover {
            background: rgba(59, 130, 246, 0.1);
        }
        
        /* Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø¨ÙŠØ§Ù†Ø§Øª */
        .no-data {
            text-align: center;
            padding: 50px 20px;
            font-size: 1.2rem;
            color: #94a3b8;
            background: rgba(30, 41, 59, 0.8);
            border-radius: 20px;
            margin-top: 20px;
        }
        
        /* Ø§Ù„ØªÙƒÙŠÙ Ù…Ø¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .weather-data {
                grid-template-columns: 1fr;
            }
            
            .compass-container {
                grid-column: span 1;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .select-wrapper, .date-wrapper {
                min-width: 100%;
            }
            
            h1 {
                font-size: 2.2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-cloud-sun"></i> Ù„ÙˆØ­Ø© Ø§Ù„Ø·Ù‚Ø³ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©</h1>
            <p>Ù…Ø±Ø§Ù‚Ø¨Ø© ÙˆØ­Ø¯Ø© Ø§Ù„Ø·Ù‚Ø³ ÙˆØ§Ù„Ø¸Ø±ÙˆÙ Ø§Ù„Ø¬ÙˆÙŠØ© ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ</p>
        </header>
        
        <div class="controls">
            <div class="select-wrapper">
                <i class="fas fa-satellite-dish"></i>
                <select id="dev">
                    <option value="max1">Ù…Ø­Ø·Ø© Ø§Ù„Ø·Ù‚Ø³ 1</option>
                    <option value="max2">Ù…Ø­Ø·Ø© Ø§Ù„Ø·Ù‚Ø³ 2</option>
                    <option value="max3">Ù…Ø­Ø·Ø© Ø§Ù„Ø·Ù‚Ø³ 3</option>
                    <option value="max4">Ù…Ø­Ø·Ø© Ø§Ù„Ø·Ù‚Ø³ 4</option>
                </select>
            </div>
            
            <div class="date-wrapper">
                <i class="fas fa-calendar-alt"></i>
                <input type="date" id="archDate">
            </div>
            
            <button onclick="loadArchive()">
                <i class="fas fa-archive"></i> Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø±Ø´ÙŠÙ
            </button>
            
            <button onclick="backToCurrent()" id="backBtn" style="display:none">
                <i class="fas fa-arrow-right"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            </button>
        </div>
        
        <div id="out"></div>
    </div>

    <script>
        // Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© (Ù„ØªØ¬Ø±Ø¨Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø¯ÙˆÙ† Ø®Ø§Ø¯Ù…)
        const mockData = {
            today: [
                {
                    temperture: 24.5,
                    humidity: 65,
                    pressure: 1013.2,
                    winds: 3.2,
                    windd: "Ø´Ù…Ø§Ù„ÙŠ ØºØ±Ø¨ÙŠ",
                    time: new Date().toISOString()
                }
            ],
            yesterday: [
                {
                    temperture: 22.8,
                    humidity: 70,
                    pressure: 1012.8,
                    winds: 2.8,
                    windd: "ØºØ±Ø¨ÙŠ",
                    reading_date: new Date(Date.now() - 86400000).toISOString()
                }
            ]
        };
        
        const mockArchive = [
            { temperture: 23.1, humidity: 68, pressure: 1013.5, winds: 2.5, windd: "Ø´Ù…Ø§Ù„ÙŠ" },
            { temperture: 24.3, humidity: 64, pressure: 1013.1, winds: 3.1, windd: "Ø´Ù…Ø§Ù„ÙŠ ØºØ±Ø¨ÙŠ" },
            { temperture: 25.7, humidity: 61, pressure: 1012.9, winds: 3.8, windd: "ØºØ±Ø¨ÙŠ" },
            { temperture: 26.2, humidity: 59, pressure: 1012.7, winds: 4.2, windd: "Ø¬Ù†ÙˆØ¨ÙŠ ØºØ±Ø¨ÙŠ" },
            { temperture: 24.9, humidity: 63, pressure: 1013.0, winds: 2.9, windd: "Ø¬Ù†ÙˆØ¨ÙŠ" },
            { temperture: 23.5, humidity: 67, pressure: 1013.3, winds: 2.3, windd: "Ø¬Ù†ÙˆØ¨ÙŠ Ø´Ø±Ù‚ÙŠ" }
        ];
        
        // Ø¯Ø§Ù„Ø© Ù„ØªØ­ÙˆÙŠÙ„ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø±ÙŠØ§Ø­ Ø¥Ù„Ù‰ Ø¯Ø±Ø¬Ø§Øª Ù„Ù„Ø¨ÙˆØµÙ„Ø©
        function windDirectionToDegrees(direction) {
            const directions = {
                "Ø´Ù…Ø§Ù„ÙŠ": 0,
                "Ø´Ù…Ø§Ù„ÙŠ Ø´Ø±Ù‚ÙŠ": 45,
                "Ø´Ø±Ù‚ÙŠ": 90,
                "Ø¬Ù†ÙˆØ¨ÙŠ Ø´Ø±Ù‚ÙŠ": 135,
                "Ø¬Ù†ÙˆØ¨ÙŠ": 180,
                "Ø¬Ù†ÙˆØ¨ÙŠ ØºØ±Ø¨ÙŠ": 225,
                "ØºØ±Ø¨ÙŠ": 270,
                "Ø´Ù…Ø§Ù„ÙŠ ØºØ±Ø¨ÙŠ": 315
            };
            
            return directions[direction] || 0;
        }
        
        // Ø¯Ø§Ù„Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙˆØµÙ„Ø© ØªÙØ§Ø¹Ù„ÙŠØ©
        function createCompass(windDirection) {
            const degrees = windDirectionToDegrees(windDirection);
            
            return `
                <div class="compass-container">
                    <div class="compass-title">Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø±ÙŠØ§Ø­</div>
                    <div class="compass">
                        <div class="compass-circle"></div>
                        <div class="compass-directions">
                            <div class="direction n">N</div>
                            <div class="direction e">E</div>
                            <div class="direction s">S</div>
                            <div class="direction w">W</div>
                        </div>
                        <div class="compass-needle" style="transform: translate(-50%, -100%) rotate(${degrees}deg);">
                            <div class="needle"></div>
                        </div>
                        <div class="compass-center"></div>
                    </div>
                    <div class="wind-direction">${windDirection}</div>
                </div>
            `;
        }
        
        // Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù‚Ø³ Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        async function loadCurrent() {
            document.getElementById("backBtn").style.display = "none";
            document.getElementById("archDate").value = "";
            
            const dev = devSel();
            
            // Ù…Ø­Ø§ÙƒØ§Ø© Ø·Ù„Ø¨ API
            const data = mockData; // Ø§Ø³ØªØ¨Ø¯Ù„ Ù‡Ø°Ø§ Ø¨Ù€ fetch Ø­Ù‚ÙŠÙ‚ÙŠ
            
            if (!data.today && !data.yesterday) {
                document.getElementById("out").innerHTML = `<div class="no-data"><i class="fas fa-exclamation-triangle"></i><br>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø©</div>`;
                return;
            }
            
            let html = '<div class="dashboard">';
            
            if (data.today.length > 0) {
                const d = data.today[data.today.length - 1];
                html += createWeatherCard("Ø§Ù„ÙŠÙˆÙ…", d, new Date(d.time).toLocaleString("ar-SA"));
            }
            
            if (data.yesterday.length > 0) {
                const d = data.yesterday[data.yesterday.length - 1];
                html += createWeatherCard("Ø£Ù…Ø³", d, new Date(d.reading_date).toLocaleString("ar-SA"));
            }
            
            html += '</div>';
            document.getElementById("out").innerHTML = html;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙˆØµÙ„Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙŠÙˆÙ…
            if (data.today.length > 0) {
                updateCompass(data.today[data.today.length - 1].windd);
            }
        }
        
        // Ø¯Ø§Ù„Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø·Ù‚Ø³
        function createWeatherCard(title, data, time) {
            return `
                <div class="weather-card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-${title === "Ø§Ù„ÙŠÙˆÙ…" ? 'sun' : 'moon'}"></i>
                            ${title}
                        </div>
                        <div class="card-time">
                            <i class="far fa-clock"></i> ${time}
                        </div>
                    </div>
                    
                    <div class="weather-data">
                        <div class="data-item">
                            <div class="data-icon">
                                <i class="fas fa-thermometer-half"></i>
                            </div>
                            <div class="data-content">
                                <h3>Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©</h3>
                                <div class="data-value">${Number(data.temperture).toFixed(1)}<span class="data-unit">Â°C</span></div>
                            </div>
                        </div>
                        
                        <div class="data-item">
                            <div class="data-icon">
                                <i class="fas fa-tint"></i>
                            </div>
                            <div class="data-content">
                                <h3>Ø§Ù„Ø±Ø·ÙˆØ¨Ø©</h3>
                                <div class="data-value">${Number(data.humidity).toFixed(1)}<span class="data-unit">%</span></div>
                            </div>
                        </div>
                        
                        <div class="data-item">
                            <div class="data-icon">
                                <i class="fas fa-tachometer-alt"></i>
                            </div>
                            <div class="data-content">
                                <h3>Ø§Ù„Ø¶ØºØ· Ø§Ù„Ø¬ÙˆÙŠ</h3>
                                <div class="data-value">${Number(data.pressure).toFixed(1)}<span class="data-unit">hPa</span></div>
                            </div>
                        </div>
                        
                        <div class="data-item">
                            <div class="data-icon">
                                <i class="fas fa-wind"></i>
                            </div>
                            <div class="data-content">
                                <h3>Ø³Ø±Ø¹Ø© Ø§Ù„Ø±ÙŠØ§Ø­</h3>
                                <div class="data-value">${data.winds || 0}<span class="data-unit">m/s</span></div>
                            </div>
                        </div>
                        
                        ${createCompass(data.windd)}
                    </div>
                </div>
            `;
        }
        
        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙˆØµÙ„Ø©
        function updateCompass(direction) {
            const needle = document.querySelector('.compass-needle');
            if (needle) {
                const degrees = windDirectionToDegrees(direction);
                needle.style.transform = `translate(-50%, -100%) rotate(${degrees}deg)`;
                
                // ØªØ­Ø¯ÙŠØ« Ù†Øµ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø±ÙŠØ§Ø­
                const windDirElement = document.querySelector('.wind-direction');
                if (windDirElement) {
                    windDirElement.textContent = direction;
                }
            }
        }
        
        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø±Ø´ÙŠÙ
        async function loadArchive() {
            const date = document.getElementById("archDate").value;
            if (!date) {
                alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± ØªØ§Ø±ÙŠØ® Ø£ÙˆÙ„Ø§Ù‹");
                return;
            }
            
            const dev = devSel();
            
            // Ù…Ø­Ø§ÙƒØ§Ø© Ø·Ù„Ø¨ API Ù„Ù„Ø£Ø±Ø´ÙŠÙ
            const rows = mockArchive; // Ø§Ø³ØªØ¨Ø¯Ù„ Ù‡Ø°Ø§ Ø¨Ù€ fetch Ø­Ù‚ÙŠÙ‚ÙŠ
            
            if (!rows || rows.length === 0) {
                document.getElementById("out").innerHTML = `<div class="no-data"><i class="fas fa-archive"></i><br>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø£Ø±Ø´ÙŠÙ Ù„Ù‡Ø°Ø§ Ø§Ù„ØªØ§Ø±ÙŠØ®</div>`;
                return;
            }
            
            document.getElementById("backBtn").style.display = "flex";
            
            let html = `
                <div class="archive-container">
                    <h2 class="archive-title">
                        <i class="fas fa-history"></i> Ø§Ù„Ø£Ø±Ø´ÙŠÙ - ${date}
                    </h2>
                    <div style="overflow-x:auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th><i class="fas fa-thermometer-half"></i> Ø§Ù„Ø­Ø±Ø§Ø±Ø©</th>
                                    <th><i class="fas fa-tint"></i> Ø§Ù„Ø±Ø·ÙˆØ¨Ø©</th>
                                    <th><i class="fas fa-tachometer-alt"></i> Ø§Ù„Ø¶ØºØ·</th>
                                    <th><i class="fas fa-wind"></i> Ø³Ø±Ø¹Ø© Ø§Ù„Ø±ÙŠØ§Ø­</th>
                                    <th><i class="fas fa-compass"></i> Ø§Ù„Ø§ØªØ¬Ø§Ù‡</th>
                                </tr>
                            </thead>
                            <tbody>`;
            
            rows.forEach((r, i) => {
                html += `
                    <tr>
                        <td>${i+1}</td>
                        <td>${Number(r.temperture).toFixed(1)} Â°C</td>
                        <td>${Number(r.humidity).toFixed(1)} %</td>
                        <td>${Number(r.pressure).toFixed(1)} hPa</td>
                        <td>${r.winds || 0} m/s</td>
                        <td>${r.windd}</td>
                    </tr>`;
            });
            
            html += `</tbody></table></div></div>`;
            document.getElementById("out").innerHTML = html;
        }
        
        // Ø¯Ø§Ù„Ø© Ù„Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        function backToCurrent() {
            loadCurrent();
        }
        
        // Ø¯Ø§Ù„Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ù…Ø­Ø¯Ø¯
        function devSel() {
            return document.getElementById("dev").value;
        }
        
        // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        document.getElementById("dev").onchange = loadCurrent;
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
        loadCurrent();
        
        // ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ© (ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©)
        setInterval(() => {
            if (document.getElementById("backBtn").style.display === "none") {
                loadCurrent();
            }
        }, 30000);
    </script>
</body>
</html>
  background:#0f172a;
  color:white;
  text-align:center;
}

.card {
  background:#1e293b;
  padding:20px;
  margin:15px;
  border-radius:12px;
  display:inline-block;
  width:260px;
}

table {
  margin:20px auto;
  border-collapse: collapse;
  width:90%;
  background:#1e293b;
}

th, td {
  border:1px solid #334155;
  padding:8px;
}

th {
  background:#334155;
}

button {
  padding:10px 18px;
  border-radius:8px;
  border:none;
  cursor:pointer;
  font-size:14px;
}
</style>
</head>

<body>

<h1>ğŸŒ¦ Weather Stations</h1>

<select id="dev">
  <option value="max1">max1</option>
  <option value="max2">max2</option>
  <option value="max3">max3</option>
  <option value="max4">max4</option>
</select>

<br><br>

ğŸ“… Ø§Ø®ØªØ± ØªØ§Ø±ÙŠØ® Ø§Ù„Ø£Ø±Ø´ÙŠÙ:
<input type="date" id="archDate">

<button onclick="loadArchive()">Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø±Ø´ÙŠÙ</button>
<button onclick="backToCurrent()" id="backBtn" style="display:none">
Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù‚Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
</button>

<div id="out"></div>

<script>

async function loadCurrent() {

  backBtn.style.display = "none";
  archDate.value = "";

  const dev = devSel();
  const r = await fetch("/api/sensor?device=" + dev);
  const data = await r.json();

  if (!data.today && !data.yesterday) {
    out.innerHTML = "No data";
    return;
  }

  let html = "";

  if (data.today.length > 0) {
    const d = data.today.at(-1);
    html += card("Today", d, d.time);
  }

  if (data.yesterday.length > 0) {
    const d = data.yesterday.at(-1);
    html += card("Yesterday", d, d.reading_date);
  }

  out.innerHTML = html;
}

function card(title, d, t) {
  return `
  <h2>${title}</h2>
  <div class="card">
    ğŸŒ¡ ${d.temperture.toFixed(1)} Â°C<br>
    ğŸ’§ ${d.humidity.toFixed(1)} %<br>
    â² ${d.pressure.toFixed(1)} hPa<br>
    ğŸ’¨ ${d.winds ?? 0} m/s<br>
    ğŸ§­ ${d.windd}<br>
    ğŸ•’ ${new Date(t).toLocaleString()}
  </div>`;
}

async function loadArchive() {

  const date = archDate.value;
  if (!date) {
    alert("Ø§Ø®ØªØ± ØªØ§Ø±ÙŠØ® Ø£ÙˆÙ„Ø§Ù‹");
    return;
  }

  const dev = devSel();

  const r = await fetch(`/api/sensor?device=${dev}&date=${date}`);
  const rows = await r.json();

  if (!rows || rows.length === 0) {
    out.innerHTML = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø£Ø±Ø´ÙŠÙ Ù„Ù‡Ø°Ø§ Ø§Ù„ØªØ§Ø±ÙŠØ®";
    return;
  }

  backBtn.style.display = "inline-block";

  let html = `<h2>Archive â€” ${date}</h2>`;
  html += `<table>
  <tr>
    <th>#</th>
    <th>Temp</th>
    <th>Humidity</th>
    <th>Pressure</th>
    <th>Wind Speed</th>
    <th>Direction</th>
  </tr>`;

  rows.forEach((r, i) => {
    html += `
    <tr>
      <td>${i+1}</td>
      <td>${Number(r.temperture).toFixed(1)}</td>
      <td>${Number(r.humidity).toFixed(1)}</td>
      <td>${Number(r.pressure).toFixed(1)}</td>
      <td>${r.winds ?? 0}</td>
      <td>${r.windd}</td>
    </tr>`;
  });

  html += "</table>";

  out.innerHTML = html;
}

function backToCurrent() {
  loadCurrent();
}

function devSel() {
  return document.getElementById("dev").value;
}

dev.onchange = loadCurrent;

loadCurrent();
setInterval(() => {
  if (backBtn.style.display === "none") loadCurrent();
}, 5000);

</script>

</body>
</html>
