<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Weather Dashboard</title>

<style>
body {
  font-family: Arial;
  background:#0f172a;
  color:white;
  text-align:center;
}

.card {
  background:#1e293b;
  padding:20px;
  margin:15px;
  border-radius:12px;
  display:inline-block;
  width:260px;
}

h2 {
  margin-top:30px;
  font-size:20px;
}
</style>
</head>

<body>

<h1>ğŸŒ¦ Weather Stations</h1>

<select id="dev">
  <option value="max1">max1</option>
  <option value="max2">max2</option>
  <option value="max3">max3</option>
  <option value="max4">max4</option>
</select>

<br><br>

ğŸ“… Ø§Ø®ØªØ± ØªØ§Ø±ÙŠØ® Ù…Ù† Ø§Ù„Ø£Ø±Ø´ÙŠÙ:
<input type="date" id="archDate">

<div id="out"></div>

<script>

async function load() {
  const dev = document.getElementById("dev").value;
  const date = document.getElementById("archDate").value;

  let url = "/api/sensor?device=" + dev;
  if (date) url += "&date=" + date;

  const r = await fetch(url);
  const data = await r.json();

  /* ===== ÙˆØ¶Ø¹ Ø§Ù„Ø£Ø±Ø´ÙŠÙ Ø­Ø³Ø¨ ØªØ§Ø±ÙŠØ® ===== */
  if (date) {
    if (!data || data.length === 0) {
      out.innerHTML = "No archive data";
      return;
    }

    const d = data[data.length - 1];

    out.innerHTML = `
      <h2>ğŸ“… Archive</h2>
      <div class="card">
        ğŸŒ¡ Temp: ${d.temperture.toFixed(1)} Â°C<br>
        ğŸ’§ Humidity: ${d.humidity.toFixed(1)} %<br>
        â² Pressure: ${d.pressure.toFixed(1)} hPa<br>
        ğŸ’¨ Wind Speed: ${d.winds ?? d.windS ?? 0} m/s<br>
        ğŸ§­ Direction: ${d.windd ?? d.windD}<br>
        ğŸ•’ ${d.reading_date}
      </div>`;
    return;
  }

  /* ===== Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ ===== */

  if (!data.today && !data.yesterday) {
    out.innerHTML = "No data";
    return;
  }

  let html = "";

  if (data.today.length > 0) {
    const d = data.today[data.today.length - 1];
    html += `
    <h2>ğŸ“… Today</h2>
    <div class="card">
      ğŸŒ¡ Temp: ${d.temperture.toFixed(1)} Â°C<br>
      ğŸ’§ Humidity: ${d.humidity.toFixed(1)} %<br>
      â² Pressure: ${d.pressure.toFixed(1)} hPa<br>
      ğŸ’¨ Wind Speed: ${d.windS ?? 0} m/s<br>
      ğŸ§­ Direction: ${d.windD}<br>
      ğŸ•’ ${new Date(d.time).toLocaleString()}
    </div>`;
  }

  if (data.yesterday.length > 0) {
    const d = data.yesterday[data.yesterday.length - 1];
    html += `
    <h2>ğŸ“… Yesterday</h2>
    <div class="card">
      ğŸŒ¡ Temp: ${d.temperture.toFixed(1)} Â°C<br>
      ğŸ’§ Humidity: ${d.humidity.toFixed(1)} %<br>
      â² Pressure: ${d.pressure.toFixed(1)} hPa<br>
      ğŸ’¨ Wind Speed: ${d.windS ?? 0} m/s<br>
      ğŸ§­ Direction: ${d.windD}<br>
      ğŸ•’ ${d.reading_date}
    </div>`;
  }

  out.innerHTML = html;
}

dev.onchange = load;
archDate.onchange = load;

load();
setInterval(load, 5000);

</script>
</body>
</html>
